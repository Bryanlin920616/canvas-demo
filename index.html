<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Go WASM Canvas</title>
  <style>
    canvas { border: 1px solid black; }
  </style>
</head>
<body>
  <h3>ğŸ–Œï¸ ä½¿ç”¨æ»‘é¼ ç•«ç·šï¼ˆGo è™•ç†ç·šæ®µï¼‰</h3>
  <canvas id="canvas" width="600" height="400"></canvas>
  <script src="wasm_exec.js"></script>
  <script>
    const go = new Go();
    WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject).then((result) => {
      go.run(result.instance);
    });

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    canvas.addEventListener("mousedown", e => {
      isDrawing = true;
      [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener("mousemove", e => {
      if (!isDrawing) return;
      const [x, y] = [e.offsetX, e.offsetY];
      const result = window.drawLine(lastX, lastY, x, y); // å‘¼å« Go WASM è™•ç†

      // ç•«ç·š
      ctx.beginPath();
      ctx.moveTo(result[0], result[1]);
      ctx.lineTo(result[2], result[3]);
      ctx.stroke();

      [lastX, lastY] = [x, y];
    });

    canvas.addEventListener("mouseup", () => isDrawing = false);
    canvas.addEventListener("mouseout", () => isDrawing = false);
  </script>
</body>
</html>
